local HttpService = game:GetService("HttpService")
local TweenService = game:GetService("TweenService")

-- GUI Elements
local ScreenGui = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local SearchBox = Instance.new("TextBox")
local SearchButton = Instance.new("TextButton")
local ResultsFrame = Instance.new("ScrollingFrame")
local DarkModeButton = Instance.new("TextButton")
local LoadMoreButton = Instance.new("TextButton")

-- GUI Setup
ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
Frame.Parent = ScreenGui
Frame.Size = UDim2.new(0.5, 0, 0.7, 0)
Frame.Position = UDim2.new(0.25, 0, 0.15, 0)
Frame.BackgroundColor3 = Color3.new(1, 1, 1)

SearchBox.Parent = Frame
SearchBox.Size = UDim2.new(0.6, 0, 0.1, 0)
SearchBox.Position = UDim2.new(0.05, 0, 0.05, 0)
SearchBox.PlaceholderText = "Search for scripts..."

SearchButton.Parent = Frame
SearchButton.Size = UDim2.new(0.3, 0, 0.1, 0)
SearchButton.Position = UDim2.new(0.7, 0, 0.05, 0)
SearchButton.Text = "Search"

ResultsFrame.Parent = Frame
ResultsFrame.Size = UDim2.new(0.9, 0, 0.65, 0)
ResultsFrame.Position = UDim2.new(0.05, 0, 0.2, 0)
ResultsFrame.CanvasSize = UDim2.new(0, 0, 2, 0)

LoadMoreButton.Parent = Frame
LoadMoreButton.Size = UDim2.new(0.4, 0, 0.1, 0)
LoadMoreButton.Position = UDim2.new(0.05, 0, 0.88, 0)
LoadMoreButton.Text = "Load More"
LoadMoreButton.Visible = false

DarkModeButton.Parent = Frame
DarkModeButton.Size = UDim2.new(0.4, 0, 0.1, 0)
DarkModeButton.Position = UDim2.new(0.55, 0, 0.88, 0)
DarkModeButton.Text = "Toggle Dark Mode"

-- Script Variables
local currentPage = 1
local darkMode = false

-- Helper function to create script card
local function createScriptCard(script)
    local ScriptFrame = Instance.new("Frame")
    ScriptFrame.Size = UDim2.new(0.9, 0, 0.1, 0)
    ScriptFrame.BackgroundColor3 = Color3.new(1, 1, 1)
    
    local Title = Instance.new("TextLabel")
    Title.Parent = ScriptFrame
    Title.Size = UDim2.new(1, 0, 1, 0)
    Title.Text = script.title
    
    ScriptFrame.Parent = ResultsFrame
    return ScriptFrame
end

-- Function to fetch scripts
local function fetchScripts(page)
    local searchInput = SearchBox.Text
    local url = "https://scriptblox-api-proxy.vercel.app/api/search?q=" .. HttpService:UrlEncode(searchInput) .. "&page=" .. page
    
    local success, response = pcall(function()
        return HttpService:GetAsync(url)
    end)
    
    if success then
        local data = HttpService:JSONDecode(response)
        if data.result.scripts then
            for _, script in pairs(data.result.scripts) do
                createScriptCard(script)
            end
            
            currentPage = page
            LoadMoreButton.Visible = currentPage < data.result.totalPages
        else
            ResultsFrame:ClearAllChildren()
            local NoScriptsLabel = Instance.new("TextLabel")
            NoScriptsLabel.Text = "No scripts found."
            NoScriptsLabel.Size = UDim2.new(1, 0, 0.1, 0)
            NoScriptsLabel.Parent = ResultsFrame
            LoadMoreButton.Visible = false
        end
    else
        warn("Failed to fetch scripts.")
    end
end

-- Event Listeners
SearchButton.MouseButton1Click:Connect(function()
    ResultsFrame:ClearAllChildren()
    fetchScripts(1)
end)

LoadMoreButton.MouseButton1Click:Connect(function()
    fetchScripts(currentPage + 1)
end)

DarkModeButton.MouseButton1Click:Connect(function()
    darkMode = not darkMode
    if darkMode then
        Frame.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
    else
        Frame.BackgroundColor3 = Color3.new(1, 1, 1)
    end
end)

-- Initial Fetch
fetchScripts(1)
